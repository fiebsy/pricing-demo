{"version":3,"file":"base-ui-menu.js","sourceRoot":"/","sources":["other-repos/demo-repo/src/components/ui/deprecated/base/menu/base-ui-menu.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Base UI Menu - Animated Menu Component\n *\n * Core menu component with optimized height transitions for nested menus.\n * Uses Base UI primitives for accessibility and positioning.\n *\n * ═══════════════════════════════════════════════════════════════════════════════\n * CONTAINER STRUCTURE\n * ═══════════════════════════════════════════════════════════════════════════════\n *\n * Container 1 (Menu.Popup)\n * ┌─────────────────────────────────────────────────────────────────────────────┐\n * │  • Outer wrapper with border, shadow, corner-squircle, appearance styling  │\n * │  • Fixed width (e.g., 200px)                                               │\n * │  • overflow: hidden (clips the sliding strip)                              │\n * │                                                                            │\n * │  Height Wrapper (animates height)                                          │\n * │  ┌────────────────────────────────────────────────────────────────────────┐│\n * │  │  • height: transitions between rootHeight ↔ submenuHeight              ││\n * │  │  • overflow: hidden                                                    ││\n * │  │                                                                        ││\n * │  │  Sliding Strip (200% width, translateX for slide)                      ││\n * │  │  ┌──────────────────────────┬──────────────────────────┐               ││\n * │  │  │                          │                          │               ││\n * │  │  │  Container 1A            │  Container 1B            │               ││\n * │  │  │  (Root Menu)             │  (Submenu: 1B1, 1B2...)  │               ││\n * │  │  │                          │                          │               ││\n * │  │  │  • w-1/2 (50% of strip)  │  • w-1/2 (50% of strip)  │               ││\n * │  │  │  • Header + menu items   │  • BackButton + items    │               ││\n * │  │  │  • opacity: 1 → 0        │  • opacity: 0 → 1        │               ││\n * │  │  │                          │                          │               ││\n * │  │  └──────────────────────────┴──────────────────────────┘               ││\n * │  │                                                                        ││\n * │  └────────────────────────────────────────────────────────────────────────┘│\n * └─────────────────────────────────────────────────────────────────────────────┘\n *\n * ═══════════════════════════════════════════════════════════════════════════════\n * WHY THIS ARCHITECTURE?\n * ═══════════════════════════════════════════════════════════════════════════════\n *\n * 1. SLIDING STRIP PATTERN (transform: translateX)\n *    ─────────────────────────────────────────────\n *    WHY: Animating `transform` is GPU-accelerated (S-Tier performance).\n *         Both panels exist side-by-side, and we simply slide the viewport.\n *\n *    HOW: Strip is 200% width. Each panel is 50% (= 100% of visible area).\n *         translateX(0) = show 1A, translateX(-50%) = show 1B\n *\n *    BENEFIT: No layout recalculation during animation. Buttery smooth 60fps.\n *\n * 2. HEIGHT ANIMATION (height property)\n *    ───────────────────────────────────\n *    WHY: Container 1A and 1B have different content heights.\n *         Without height animation, switching panels causes jarring jumps.\n *\n *    HOW: ResizeObserver measures each panel's natural height.\n *         Height wrapper transitions between rootHeight ↔ submenuHeight.\n *\n *    CRITICAL: `items-start` on the flex container prevents panels from\n *              stretching to match each other. Without this, both panels\n *              would have the same height (the taller one), breaking\n *              the height transition effect.\n *\n * 3. OPACITY CROSSFADE\n *    ──────────────────\n *    WHY: Pure slide looks mechanical. Crossfade adds perceived smoothness.\n *         The outgoing panel fades as the incoming panel appears.\n *\n *    HOW: 1A: opacity 1→0 when entering submenu, 0→1 when returning\n *         1B: opacity 0→1 when entering submenu, 1→0 when returning\n *         Duration is 80% of slide duration for overlap effect.\n *\n * 4. TWO-PHASE ANIMATION TRIGGER\n *    ────────────────────────────\n *    WHY: We must measure 1B's height BEFORE animating, otherwise the\n *         height wrapper doesn't know what to transition to.\n *\n *    HOW: 1) submenuData is set → content renders (but no animation yet)\n *         2) Wait 2 frames for layout calculation\n *         3) Measure submenuRef height synchronously\n *         4) Set shouldAnimateToSubmenu → triggers slide + height + opacity\n *\n * ═══════════════════════════════════════════════════════════════════════════════\n * ANIMATION PERFORMANCE TIER\n * ═══════════════════════════════════════════════════════════════════════════════\n *\n * | Property  | Tier   | Notes                                    |\n * |-----------|--------|------------------------------------------|\n * | transform | S-Tier | GPU-accelerated, no layout recalc        |\n * | opacity   | S-Tier | GPU-accelerated, no layout recalc        |\n * | height    | B-Tier | Causes layout recalc, but acceptable for |\n * |           |        | small menus with smooth easing           |\n *\n * @module base-ui/menu/base-ui-menu\n */\n\n'use client'\n\nimport React, { useCallback, useState, useRef, useEffect, useLayoutEffect } from 'react'\nimport { Menu } from '@base-ui/react/menu'\n\nimport { cn } from '@/lib/utils'\nimport type { BaseUIMenuProps, MenuItem } from './types'\nimport {\n  DEFAULT_MENU_PROPS,\n  DEFAULT_SLIDE_TRANSITION,\n  DEFAULT_APPEARANCE,\n  getAppearanceClasses,\n  getAppearanceStyle,\n  calculateItemRadius,\n  STATE_RESET_DELAY,\n} from './config'\nimport { MenuItemComponent, BackButton } from './components'\n\n// ============================================================================\n// Component\n// ============================================================================\n\n/**\n * Animated menu with nested submenu support\n * Built on Base UI Menu primitives\n *\n * Uses horizontal sliding strip for left-right navigation\n * Container 1 height animates based on active panel (1A vs 1B)\n */\nexport const BaseUIMenu: React.FC<BaseUIMenuProps> = ({\n  trigger,\n  items,\n  align = DEFAULT_MENU_PROPS.align,\n  side = DEFAULT_MENU_PROPS.side,\n  sideOffset = DEFAULT_MENU_PROPS.sideOffset,\n  alignOffset = 0,\n  width = DEFAULT_MENU_PROPS.width,\n  variant = DEFAULT_MENU_PROPS.variant,\n  open: controlledOpen,\n  onOpenChange,\n  className,\n  appearance,\n  slideTransition = DEFAULT_SLIDE_TRANSITION,\n  modal = false,\n  header,\n  // Panel Navigation Animation (1A ↔ 1B)\n  heightAnimationEnabled = true,\n  opacityCrossfadeEnabled = true,\n  opacityDurationRatio = 0.8,\n}) => {\n  // ============================================================================\n  // State\n  // ============================================================================\n\n  const [internalOpen, setInternalOpen] = useState(false)\n  const isOpen = controlledOpen ?? internalOpen\n\n  // Submenu content - stored separately to control render timing\n  // WHY: We need content to render BEFORE animation starts (for height measurement)\n  const [submenuData, setSubmenuData] = useState<{\n    id: string\n    title: string\n    items: MenuItem[]\n  } | null>(null)\n\n  // Animation state flags\n  // WHY: Two-phase approach - render content first, then animate\n  const [shouldAnimateToSubmenu, setShouldAnimateToSubmenu] = useState(false)\n  const [isNavigatingBack, setIsNavigatingBack] = useState(false)\n\n  // Measured heights for Container 1A and 1B\n  // WHY: Height wrapper needs explicit pixel values to animate between\n  const [rootHeight, setRootHeight] = useState<number>(0)\n  const [submenuHeight, setSubmenuHeight] = useState<number>(0)\n\n  // Derived state: Are we currently showing the submenu?\n  // WHY: This single boolean controls slide position, opacity, and height target\n  // It's only true when: content exists AND animation should play AND not going back\n  const inSubmenu = shouldAnimateToSubmenu && !isNavigatingBack\n\n  // Refs\n  const wasOpenRef = useRef(false)\n  const rootRef = useRef<HTMLDivElement>(null)      // Container 1A\n  const submenuRef = useRef<HTMLDivElement>(null)   // Container 1B\n\n  // ============================================================================\n  // Height Measurement with ResizeObserver\n  // Measures Container 1A (rootRef) and Container 1B (submenuRef)\n  // ============================================================================\n\n  useLayoutEffect(() => {\n    if (!isOpen) return\n\n    const observer = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const height = entry.borderBoxSize?.[0]?.blockSize ?? entry.contentRect.height\n        if (entry.target === rootRef.current) {\n          setRootHeight(height)\n        } else if (entry.target === submenuRef.current) {\n          setSubmenuHeight(height)\n        }\n      }\n    })\n\n    if (rootRef.current) observer.observe(rootRef.current)\n    if (submenuRef.current) observer.observe(submenuRef.current)\n\n    return () => observer.disconnect()\n  }, [isOpen])\n\n  // ============================================================================\n  // Wait for submenu (Container 1B) to render before animating\n  // Ensures height is measured before transition starts\n  // ============================================================================\n\n  useEffect(() => {\n    if (submenuData && !shouldAnimateToSubmenu && !isNavigatingBack) {\n      // Wait 2 frames: 1 for React render, 1 for layout calculation\n      let frame1: number\n      let frame2: number\n\n      frame1 = requestAnimationFrame(() => {\n        frame2 = requestAnimationFrame(() => {\n          // Always do synchronous height measurement before animating\n          // This ensures we have the correct submenu height after content renders\n          if (submenuRef.current) {\n            const rect = submenuRef.current.getBoundingClientRect()\n            if (rect.height > 0) {\n              setSubmenuHeight(rect.height)\n            }\n          }\n          setShouldAnimateToSubmenu(true)\n        })\n      })\n\n      return () => {\n        cancelAnimationFrame(frame1)\n        cancelAnimationFrame(frame2)\n      }\n    }\n  }, [submenuData, shouldAnimateToSubmenu, isNavigatingBack])\n\n  // ============================================================================\n  // Reset on Close\n  // ============================================================================\n\n  useEffect(() => {\n    if (!isOpen && wasOpenRef.current) {\n      const timeout = setTimeout(() => {\n        setSubmenuData(null)\n        setShouldAnimateToSubmenu(false)\n        setIsNavigatingBack(false)\n      }, STATE_RESET_DELAY)\n      return () => clearTimeout(timeout)\n    }\n    wasOpenRef.current = isOpen\n  }, [isOpen])\n\n  // ============================================================================\n  // Navigation\n  // ============================================================================\n\n  const navigateToSubmenu = useCallback((menuId: string) => {\n    // Capture submenu data immediately - animation starts after measurement\n    const submenuItem = items.find(\n      (item) => item.id === menuId && item.type === 'submenu'\n    )\n    if (submenuItem && 'items' in submenuItem) {\n      setSubmenuData({\n        id: menuId,\n        title: submenuItem.label,\n        items: submenuItem.items,\n      })\n      setIsNavigatingBack(false)\n      // Note: shouldAnimateToSubmenu is set by the effect after height is measured\n    }\n  }, [items])\n\n  const navigateBack = useCallback(() => {\n    setIsNavigatingBack(true)\n    setShouldAnimateToSubmenu(false)\n    // Delay clearing submenu data so content stays visible during slide-out\n    setTimeout(() => {\n      setSubmenuData(null)\n      setIsNavigatingBack(false)\n    }, slideTransition.duration)\n  }, [slideTransition.duration])\n\n  // ============================================================================\n  // Handlers\n  // ============================================================================\n\n  const handleOpenChange = useCallback(\n    (open: boolean) => {\n      setInternalOpen(open)\n      onOpenChange?.(open)\n    },\n    [onOpenChange]\n  )\n\n  const handleSelect = useCallback(() => {\n    handleOpenChange(false)\n  }, [handleOpenChange])\n\n  // ============================================================================\n  // Render Helpers\n  // ============================================================================\n\n  const renderMenuItem = useCallback(\n    (item: MenuItem) => (\n      <MenuItemComponent\n        key={item.id}\n        item={item}\n        variant={variant}\n        onSubmenuClick={navigateToSubmenu}\n        onSelect={handleSelect}\n      />\n    ),\n    [variant, navigateToSubmenu, handleSelect]\n  )\n\n  // ============================================================================\n  // Animation Timing\n  // ============================================================================\n\n  // Shared transition timing for slide and height\n  const transitionStyle = `${slideTransition.duration}ms ${slideTransition.easing}`\n\n  // Height target: switches based on which panel is active\n  // WHY: This is what makes Container 1 grow/shrink smoothly\n  const targetHeight = inSubmenu ? submenuHeight : rootHeight\n  const hasHeight = heightAnimationEnabled && targetHeight > 0\n\n  // Opacity crossfade: controlled by opacityDurationRatio prop\n  // WHY: Lower ratio = faster fade, creating more overlap effect\n  const opacityDuration = Math.round(slideTransition.duration * opacityDurationRatio)\n  const opacityTransitionStyle = `${opacityDuration}ms ${slideTransition.easing}`\n\n  // Opacity values based on whether crossfade is enabled\n  const panel1AOpacity = opacityCrossfadeEnabled ? (inSubmenu ? 0 : 1) : 1\n  const panel1BOpacity = opacityCrossfadeEnabled ? (inSubmenu ? 1 : 0) : 1\n\n  // ============================================================================\n  // Render\n  // ============================================================================\n\n  return (\n    <Menu.Root open={isOpen} onOpenChange={handleOpenChange} modal={modal}>\n      <Menu.Trigger nativeButton={false} render={<span className=\"outline-none focus:outline-none\" />}>\n        {trigger}\n      </Menu.Trigger>\n\n      <Menu.Portal>\n        <Menu.Positioner\n          side={side}\n          align={align}\n          sideOffset={sideOffset}\n          alignOffset={alignOffset}\n          collisionPadding={DEFAULT_MENU_PROPS.collisionPadding}\n          className=\"!z-[9999]\"\n        >\n          <Menu.Popup\n            data-menu-popup=\"\"\n            className={cn(\n              'z-[9999] overflow-hidden',\n              getAppearanceClasses(appearance),\n              !className && [\n                'data-[open]:animate-in data-[open]:fade-in-0 data-[open]:zoom-in-95',\n                'data-[closed]:animate-out data-[closed]:fade-out-0 data-[closed]:zoom-out-95',\n                'duration-200 ease-out',\n              ],\n              'menu-popup',\n              className\n            )}\n            style={{\n              width,\n              ...getAppearanceStyle(appearance),\n              // Dynamic item radius: container radius - padding\n              '--menu-item-radius': `${calculateItemRadius(\n                appearance?.borderRadius ?? DEFAULT_APPEARANCE.borderRadius,\n                variant\n              )}px`,\n            } as React.CSSProperties}\n          >\n            {/*\n             * ┌─────────────────────────────────────────────────────────────┐\n             * │ HEIGHT WRAPPER                                              │\n             * │ • Animates between rootHeight ↔ submenuHeight               │\n             * │ • overflow:hidden clips content during transition           │\n             * │ • B-Tier animation (height causes layout recalc)            │\n             * └─────────────────────────────────────────────────────────────┘\n             */}\n            <div\n              className=\"relative overflow-hidden\"\n              style={{\n                height: hasHeight ? targetHeight : 'auto',\n                transition: hasHeight ? `height ${transitionStyle}` : 'none',\n              }}\n            >\n              {/*\n               * ┌─────────────────────────────────────────────────────────────┐\n               * │ SLIDING STRIP                                               │\n               * │ • 200% width = both panels side-by-side                     │\n               * │ • translateX(0) = show 1A, translateX(-50%) = show 1B       │\n               * │ • S-Tier animation (transform is GPU-accelerated)           │\n               * │                                                             │\n               * │ CRITICAL: items-start prevents flex stretch!                │\n               * │ Without it, both panels match the taller one's height,      │\n               * │ which breaks height measurement and animation.              │\n               * └─────────────────────────────────────────────────────────────┘\n               */}\n              <div\n                className=\"flex items-start w-[200%]\"\n                style={{\n                  transform: inSubmenu ? 'translateX(-50%)' : 'translateX(0)',\n                  transition: `transform ${transitionStyle}`,\n                }}\n              >\n                {/*\n                 * CONTAINER 1A - Root/Parent Menu\n                 * • Always rendered (never unmounted)\n                 * • opacity: 1→0 when entering submenu (if crossfade enabled)\n                 * • w-1/2 = 50% of strip = 100% of visible area\n                 */}\n                <div\n                  ref={rootRef}\n                  className=\"w-1/2 flex-shrink-0 p-1\"\n                  style={{\n                    opacity: panel1AOpacity,\n                    transition: opacityCrossfadeEnabled ? `opacity ${opacityTransitionStyle}` : 'none',\n                  }}\n                >\n                  {header && (\n                    <div className=\"mb-1 px-1\">\n                      {header}\n                    </div>\n                  )}\n                  <div className=\"flex flex-col gap-1\">\n                    {items.map(renderMenuItem)}\n                  </div>\n                </div>\n\n                {/*\n                 * CONTAINER 1B - Submenu Panel\n                 * • Content renders when submenuData is set (before animation)\n                 * • opacity: 0→1 when entering submenu (if crossfade enabled)\n                 * • pointerEvents: none when hidden (prevents accidental clicks)\n                 * • Can be 1B1 (Notifications), 1B2 (Invite Users), etc.\n                 */}\n                <div\n                  ref={submenuRef}\n                  className=\"w-1/2 flex-shrink-0 p-1\"\n                  style={{\n                    opacity: panel1BOpacity,\n                    transition: opacityCrossfadeEnabled ? `opacity ${opacityTransitionStyle}` : 'none',\n                    pointerEvents: inSubmenu ? 'auto' : 'none',\n                  }}\n                >\n                  {submenuData && (\n                    <>\n                      <BackButton\n                        title={submenuData.title}\n                        onBack={navigateBack}\n                      />\n                      <div className=\"flex flex-col gap-1\">\n                        {submenuData.items.map(renderMenuItem)}\n                      </div>\n                    </>\n                  )}\n                </div>\n              </div>\n            </div>\n          </Menu.Popup>\n        </Menu.Positioner>\n      </Menu.Portal>\n    </Menu.Root>\n  )\n}\n\nBaseUIMenu.displayName = 'BaseUIMenu'\n"]}