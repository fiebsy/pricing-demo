{"version":3,"file":"use-column-flip.js","sourceRoot":"/","sources":["other-repos/demo-repo/src/components/ui/deprecated/sticky-data-table/hooks/use-column-flip.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * StickyDataTable V2 - Column FLIP Animation Hook\n *\n * Implements the FLIP technique (First, Last, Invert, Play) for smooth\n * column add/remove animations. Uses Web Animations API (WAAPI) for\n * S-Tier performance (transform-only animations).\n *\n * @see https://aerotwist.com/blog/flip-your-animations/\n * @see /docs/frontend/ANIMATION-PREFERENCES.md (B-Tier FLIP pattern)\n *\n * @module hooks/use-column-flip\n */\n\nimport { useCallback, useRef } from 'react'\n\nimport { ANIMATION_CONFIG } from '../config'\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\ninterface ColumnPosition {\n  key: string\n  left: number\n  width: number\n}\n\ninterface UseColumnFlipOptions {\n  /** Minimum delta (px) to trigger animation - avoids micro-animations */\n  threshold?: number\n  /** Animation duration in ms */\n  duration?: number\n  /** CSS easing function */\n  easing?: string\n}\n\ninterface UseColumnFlipReturn {\n  /** Call before DOM changes to capture current positions */\n  capturePositions: () => void\n  /** Call after DOM changes to animate neighbors into place */\n  animateShifts: () => void\n  /** Check if FLIP animation is currently running */\n  isAnimating: boolean\n}\n\n// ============================================================================\n// CONSTANTS\n// ============================================================================\n\nconst DEFAULT_OPTIONS: Required<UseColumnFlipOptions> = {\n  threshold: 2, // Minimum 2px movement to animate\n  duration: ANIMATION_CONFIG.COLUMN_ANIMATION_DURATION,\n  easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)', // --ease-standard from ANIMATION-PREFERENCES.md\n}\n\n// ============================================================================\n// HOOK IMPLEMENTATION\n// ============================================================================\n\n/**\n * Hook for FLIP-based column animations\n *\n * Usage:\n * ```tsx\n * const { capturePositions, animateShifts } = useColumnFlip(containerRef)\n *\n * const toggleColumn = (key: string) => {\n *   capturePositions()           // FIRST: Record positions\n *   setVisibleColumns(...)       // DOM update\n *   requestAnimationFrame(() => {\n *     animateShifts()            // LAST + INVERT + PLAY\n *   })\n * }\n * ```\n */\nexport function useColumnFlip(\n  containerRef: React.RefObject<HTMLElement>,\n  options: UseColumnFlipOptions = {}\n): UseColumnFlipReturn {\n  const { threshold, duration, easing } = { ...DEFAULT_OPTIONS, ...options }\n\n  // Store column positions from FIRST phase\n  const positionsRef = useRef<Map<string, ColumnPosition>>(new Map())\n  const isAnimatingRef = useRef(false)\n\n  /**\n   * FIRST: Capture current positions of all columns\n   * Call this BEFORE making DOM changes\n   */\n  const capturePositions = useCallback(() => {\n    const container = containerRef.current\n    if (!container) return\n\n    const columns = container.querySelectorAll('[data-column-key]')\n    const positions = new Map<string, ColumnPosition>()\n\n    columns.forEach((el) => {\n      const key = el.getAttribute('data-column-key')\n      if (!key) return\n\n      const rect = el.getBoundingClientRect()\n      positions.set(key, {\n        key,\n        left: rect.left,\n        width: rect.width,\n      })\n    })\n\n    positionsRef.current = positions\n  }, [containerRef])\n\n  /**\n   * LAST + INVERT + PLAY: Calculate deltas and animate\n   * Call this AFTER DOM changes have been applied\n   */\n  const animateShifts = useCallback(() => {\n    const container = containerRef.current\n    if (!container) return\n\n    // Check for reduced motion preference\n    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches\n    if (prefersReducedMotion) return\n\n    const oldPositions = positionsRef.current\n    if (oldPositions.size === 0) return\n\n    isAnimatingRef.current = true\n\n    // Use RAF to ensure DOM has updated\n    requestAnimationFrame(() => {\n      const columns = container.querySelectorAll('[data-column-key]')\n      const animations: Animation[] = []\n\n      columns.forEach((el) => {\n        const key = el.getAttribute('data-column-key')\n        if (!key) return\n\n        const oldPos = oldPositions.get(key)\n        if (!oldPos) return // New column, handled by enter animation\n\n        const newRect = el.getBoundingClientRect()\n        const deltaX = oldPos.left - newRect.left\n\n        // Only animate if movement exceeds threshold\n        if (Math.abs(deltaX) <= threshold) return\n\n        // Skip columns that are entering or leaving (they have their own animations)\n        if (el.hasAttribute('data-column-entering') || el.hasAttribute('data-column-leaving')) {\n          return\n        }\n\n        // INVERT + PLAY: Animate from old position to new position\n        const animation = el.animate(\n          [\n            { transform: `translateX(${deltaX}px)` },\n            { transform: 'translateX(0)' },\n          ],\n          {\n            duration,\n            easing,\n            fill: 'none',\n          }\n        )\n\n        animations.push(animation)\n      })\n\n      // Clear positions and animating state when all animations complete\n      if (animations.length > 0) {\n        Promise.all(animations.map((a) => a.finished))\n          .then(() => {\n            isAnimatingRef.current = false\n            positionsRef.current.clear()\n          })\n          .catch(() => {\n            // Animation was cancelled, that's fine\n            isAnimatingRef.current = false\n          })\n      } else {\n        isAnimatingRef.current = false\n        positionsRef.current.clear()\n      }\n    })\n  }, [containerRef, threshold, duration, easing])\n\n  return {\n    capturePositions,\n    animateShifts,\n    get isAnimating() {\n      return isAnimatingRef.current\n    },\n  }\n}\n\n// ============================================================================\n// UTILITY FUNCTIONS\n// ============================================================================\n\n/**\n * Check if the browser supports Web Animations API\n * All modern browsers support it, but good to have a fallback check\n */\nexport function supportsWAAPI(): boolean {\n  return typeof Element.prototype.animate === 'function'\n}\n\n/**\n * Check if user prefers reduced motion\n */\nexport function prefersReducedMotion(): boolean {\n  if (typeof window === 'undefined') return false\n  return window.matchMedia('(prefers-reduced-motion: reduce)').matches\n}\n"]}