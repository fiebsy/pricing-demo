/**
 * Menu Panel Transition CSS
 *
 * All transitions are GPU-composited (transform, opacity).
 * Data attributes control animation state - no JS during animation.
 *
 * @see TRANSITION-ANIMATION.md for documentation
 */

/* Height wrapper */
.menu-height-wrapper {
  height: var(--menu-target-height);
  transition: var(--menu-height-transition);
}

/* Sliding strip */
.menu-sliding-strip {
  transform: translateX(0);
  transition: transform var(--menu-slide-duration) var(--menu-slide-easing);
  will-change: transform;
}

[data-menu-view="submenu"] .menu-sliding-strip {
  transform: translateX(-50%);
}

/* ==========================================================================
   DEFAULT INITIAL STATES
   Prevent flash by ensuring panels have opacity before mode rules apply
   ========================================================================== */

.menu-panel-root,
.menu-panel-submenu {
  /* Force GPU compositing for smoother animations */
  transform: translateZ(0);
  backface-visibility: hidden;
}

.menu-panel-root {
  opacity: 1;
}

.menu-panel-submenu {
  opacity: 0;
}

/* ==========================================================================
   STARTING STYLE
   Defines initial state for elements entering the DOM.
   Prevents flash by ensuring opacity starts at correct value before first paint.
   Browser support: Chrome 117+, Safari 17.4+, Firefox 129+
   ========================================================================== */

@starting-style {
  .menu-panel-root {
    opacity: 1;
  }

  .menu-panel-submenu {
    opacity: 0;
  }
}

/* ==========================================================================
   OPACITY MODE: none
   Both panels always visible
   ========================================================================== */

[data-menu-mode="none"] .menu-panel-root,
[data-menu-mode="none"] .menu-panel-submenu {
  opacity: 1;
  transition: none;
}

/* ==========================================================================
   OPACITY MODE: instant
   Opacity flips immediately with no transition
   ========================================================================== */

[data-menu-mode="instant"] .menu-panel-root {
  opacity: 1;
  transition: none;
}

[data-menu-mode="instant"][data-menu-view="submenu"] .menu-panel-root {
  opacity: 0;
}

[data-menu-mode="instant"] .menu-panel-submenu {
  opacity: 0;
  transition: none;
}

[data-menu-mode="instant"][data-menu-view="submenu"] .menu-panel-submenu {
  opacity: 1;
}

/* ==========================================================================
   OPACITY MODE: instant-out-fade-in
   Outgoing disappears instantly, incoming fades in.
   Direction-aware: "outgoing" depends on navigation direction.
   ========================================================================== */

/* Going FORWARD: root is outgoing (instant), submenu is incoming (fade) */
[data-menu-mode="instant-out-fade-in"][data-menu-direction="forward"] .menu-panel-root {
  opacity: 1;
  transition: none;
}

[data-menu-mode="instant-out-fade-in"][data-menu-direction="forward"][data-menu-view="submenu"] .menu-panel-root {
  opacity: 0;
}

[data-menu-mode="instant-out-fade-in"][data-menu-direction="forward"] .menu-panel-submenu {
  opacity: 0;
  transition: opacity var(--menu-fade-duration) var(--menu-fade-easing);
}

[data-menu-mode="instant-out-fade-in"][data-menu-direction="forward"][data-menu-view="submenu"] .menu-panel-submenu {
  opacity: 1;
}

/* Going BACK: submenu is outgoing (instant), root is incoming (fade) */
[data-menu-mode="instant-out-fade-in"][data-menu-direction="back"] .menu-panel-root {
  opacity: 0;
  transition: opacity var(--menu-fade-duration) var(--menu-fade-easing);
}

[data-menu-mode="instant-out-fade-in"][data-menu-direction="back"][data-menu-view="root"] .menu-panel-root {
  opacity: 1;
}

[data-menu-mode="instant-out-fade-in"][data-menu-direction="back"] .menu-panel-submenu {
  opacity: 1;
  transition: none;
}

[data-menu-mode="instant-out-fade-in"][data-menu-direction="back"][data-menu-view="root"] .menu-panel-submenu {
  opacity: 0;
}

/* ==========================================================================
   OPACITY MODE: quick-out-fade-in
   Outgoing fades out quickly, incoming fades in after optional delay.
   Smoother than instant-out but still feels snappy.
   - quickOutDuration: how fast outgoing fades (default 0ms = instant)
   - fadeInDelay: delay before incoming starts fading in
   - opacityDuration: how long incoming takes to fade in
   ========================================================================== */

/* Going FORWARD: root fades out quickly, submenu fades in with delay */
[data-menu-mode="quick-out-fade-in"][data-menu-direction="forward"] .menu-panel-root {
  opacity: 1;
  pointer-events: auto;
  transition:
    opacity var(--menu-quick-out-duration) var(--menu-fade-easing),
    pointer-events 0s 0s;
}

[data-menu-mode="quick-out-fade-in"][data-menu-direction="forward"][data-menu-view="submenu"] .menu-panel-root {
  opacity: 0;
  pointer-events: none;
}

[data-menu-mode="quick-out-fade-in"][data-menu-direction="forward"] .menu-panel-submenu {
  opacity: 0;
  pointer-events: none;
  transition:
    opacity var(--menu-fade-duration) var(--menu-fade-easing) var(--menu-fade-in-delay),
    pointer-events 0s 0s;
}

[data-menu-mode="quick-out-fade-in"][data-menu-direction="forward"][data-menu-view="submenu"] .menu-panel-submenu {
  opacity: 1;
  pointer-events: auto;
  transition:
    opacity var(--menu-fade-duration) var(--menu-fade-easing) var(--menu-fade-in-delay),
    pointer-events 0s calc(var(--menu-fade-in-delay) + var(--menu-fade-duration));
}

/* Going BACK: submenu fades out quickly, root fades in with delay */
[data-menu-mode="quick-out-fade-in"][data-menu-direction="back"] .menu-panel-root {
  opacity: 0;
  pointer-events: none;
  transition:
    opacity var(--menu-fade-duration) var(--menu-fade-easing) var(--menu-fade-in-delay),
    pointer-events 0s 0s;
}

[data-menu-mode="quick-out-fade-in"][data-menu-direction="back"][data-menu-view="root"] .menu-panel-root {
  opacity: 1;
  pointer-events: auto;
  transition:
    opacity var(--menu-fade-duration) var(--menu-fade-easing) var(--menu-fade-in-delay),
    pointer-events 0s calc(var(--menu-fade-in-delay) + var(--menu-fade-duration));
}

[data-menu-mode="quick-out-fade-in"][data-menu-direction="back"] .menu-panel-submenu {
  opacity: 1;
  pointer-events: auto;
  transition:
    opacity var(--menu-quick-out-duration) var(--menu-fade-easing),
    pointer-events 0s 0s;
}

[data-menu-mode="quick-out-fade-in"][data-menu-direction="back"][data-menu-view="root"] .menu-panel-submenu {
  opacity: 0;
  pointer-events: none;
}

/* ==========================================================================
   OPACITY MODE: crossfade
   Asymmetric crossfade: outgoing fades out quickly, incoming fades in smoothly.
   Uses --menu-quick-out-duration for outgoing, --menu-fade-duration for incoming.
   Pointer-events: outgoing disabled immediately, incoming enabled after quick-out completes.
   ========================================================================== */

/* Root panel - visible initially, becomes interactive after quick-out */
[data-menu-mode="crossfade"] .menu-panel-root {
  opacity: 1;
  pointer-events: auto;
  transition:
    opacity var(--menu-fade-duration) var(--menu-fade-easing),
    pointer-events 0s var(--menu-quick-out-duration);
}

/* Root panel fading OUT - pointer-events disabled immediately */
[data-menu-mode="crossfade"][data-menu-view="submenu"] .menu-panel-root {
  opacity: 0;
  pointer-events: none;
  transition:
    opacity var(--menu-quick-out-duration) var(--menu-fade-easing),
    pointer-events 0s 0s;
}

/* Submenu panel - hidden, pointer-events disabled immediately */
[data-menu-mode="crossfade"] .menu-panel-submenu {
  opacity: 0;
  pointer-events: none;
  transition:
    opacity var(--menu-quick-out-duration) var(--menu-fade-easing),
    pointer-events 0s 0s;
}

/* Submenu panel fading IN - pointer-events enabled after outgoing fades (80ms) */
[data-menu-mode="crossfade"][data-menu-view="submenu"] .menu-panel-submenu {
  opacity: 1;
  pointer-events: auto;
  transition:
    opacity var(--menu-fade-duration) var(--menu-fade-easing),
    pointer-events 0s var(--menu-quick-out-duration);
}

/* ==========================================================================
   OPACITY MODE: sequential
   Outgoing fades first, then incoming fades in after stagger delay
   ========================================================================== */

/* Going FORWARD: root fades out immediately, submenu waits then fades in */
[data-menu-mode="sequential"][data-menu-direction="forward"] .menu-panel-root {
  opacity: 1;
  transition: opacity var(--menu-fade-duration) var(--menu-fade-easing);
}

[data-menu-mode="sequential"][data-menu-direction="forward"][data-menu-view="submenu"] .menu-panel-root {
  opacity: 0;
}

[data-menu-mode="sequential"][data-menu-direction="forward"] .menu-panel-submenu {
  opacity: 0;
  transition: opacity var(--menu-fade-duration) var(--menu-fade-easing) var(--menu-stagger-delay);
}

[data-menu-mode="sequential"][data-menu-direction="forward"][data-menu-view="submenu"] .menu-panel-submenu {
  opacity: 1;
}

/* Going BACK: submenu fades out immediately, root waits then fades in */
[data-menu-mode="sequential"][data-menu-direction="back"] .menu-panel-root {
  opacity: 0;
  transition: opacity var(--menu-fade-duration) var(--menu-fade-easing) var(--menu-stagger-delay);
}

[data-menu-mode="sequential"][data-menu-direction="back"][data-menu-view="root"] .menu-panel-root {
  opacity: 1;
}

[data-menu-mode="sequential"][data-menu-direction="back"] .menu-panel-submenu {
  opacity: 1;
  transition: opacity var(--menu-fade-duration) var(--menu-fade-easing);
}

[data-menu-mode="sequential"][data-menu-direction="back"][data-menu-view="root"] .menu-panel-submenu {
  opacity: 0;
}

/* ==========================================================================
   Accessibility: Respect reduced motion preference
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
  .menu-height-wrapper,
  .menu-sliding-strip,
  .menu-panel-root,
  .menu-panel-submenu {
    transition: none !important;
  }
}
