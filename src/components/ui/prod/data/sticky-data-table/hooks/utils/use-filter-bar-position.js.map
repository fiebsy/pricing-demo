{"version":3,"file":"use-filter-bar-position.js","sourceRoot":"/","sources":["other-repos/demo-repo/src/components/ui/prod/data/sticky-data-table/hooks/utils/use-filter-bar-position.ts"],"names":[],"mappings":"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","sourcesContent":["'use client'\n\n/**\n * StickyDataTable - Filter Bar Position Hook\n *\n * Positions the filter bar with two modes:\n * 1. FIXED to viewport bottom (80px up) when table is tall\n * 2. ABSOLUTE below table (80px down) when table is short\n *\n * The bar is rendered OUTSIDE the sticky wrapper to avoid coordinate\n * system issues caused by the sticky header's shifting position.\n *\n * @module hooks/use-filter-bar-position\n */\n\nimport { useState, useEffect, useCallback } from 'react'\n\nexport interface FilterBarPosition {\n  /** Style object to apply to the filter bar container */\n  style: React.CSSProperties\n  /** Current positioning mode */\n  mode: 'fixed' | 'absolute'\n  /** Whether position has been calculated (hide bar until ready) */\n  isReady: boolean\n}\n\ninterface UseFilterBarPositionProps {\n  /** Reference to the table container element (parent of both header and body) */\n  tableContainerRef: React.RefObject<HTMLDivElement | null>\n  /** Reference to table body element (for measuring table height) */\n  bodyRef: React.RefObject<HTMLDivElement | null>\n  /** Distance from viewport bottom when in fixed mode (default: 80px) */\n  bottomOffset?: number\n  /** Height of the filter bar for calculations (default: 40px) */\n  barHeight?: number\n}\n\ninterface PositionState {\n  mode: 'fixed' | 'absolute'\n  /** For absolute: distance from container top. For fixed: not used */\n  top?: number\n  /** For fixed: distance from viewport bottom. For absolute: not used */\n  bottom?: number\n  /** For fixed: calculated left position to center on table */\n  left?: number\n  /** Width of the table container (for centering reference) */\n  containerWidth?: number\n  /** Whether position has been calculated */\n  isReady: boolean\n}\n\n/**\n * Hook for filter bar positioning\n *\n * Renders the bar outside the sticky wrapper and toggles between:\n * - position: fixed (when table extends past viewport)\n * - position: absolute (when table is short)\n *\n * Horizontal centering:\n * - Absolute mode: left: 50% naturally centers on table container\n * - Fixed mode: calculates table center in viewport coordinates\n */\nexport function useFilterBarPosition({\n  tableContainerRef,\n  bodyRef,\n  bottomOffset = 80,\n  barHeight = 40,\n}: UseFilterBarPositionProps): FilterBarPosition {\n  const [position, setPosition] = useState<PositionState>({\n    mode: 'fixed',\n    bottom: bottomOffset,\n    left: 0,\n    isReady: false,\n  })\n\n  const calculatePosition = useCallback(() => {\n    const container = tableContainerRef.current\n    const body = bodyRef.current\n    if (!container || !body) return\n\n    const containerRect = container.getBoundingClientRect()\n    const bodyRect = body.getBoundingClientRect()\n    const viewportHeight = window.innerHeight\n\n    // The Y position where the bar would be if fixed to viewport bottom\n    const fixedBarY = viewportHeight - bottomOffset - barHeight\n\n    // The Y position of the table's bottom edge\n    const tableBottomY = bodyRect.bottom\n\n    // Calculate table center X in viewport coordinates (for fixed positioning)\n    // Use bodyRect for horizontal centering since it's the actual visible table area\n    const tableCenterX = bodyRect.left + bodyRect.width / 2\n\n    // Decision: If table bottom is above where fixed bar would be,\n    // use absolute positioning to keep bar near table\n    if (tableBottomY < fixedBarY) {\n      // Table is short - position bar below table using absolute\n      // Calculate top relative to the container\n      const absoluteTop = bodyRect.bottom - containerRect.top + bottomOffset\n\n      setPosition({\n        mode: 'absolute',\n        top: absoluteTop,\n        containerWidth: containerRect.width,\n        isReady: true,\n      })\n    } else {\n      // Table is tall - use fixed positioning at viewport bottom\n      setPosition({\n        mode: 'fixed',\n        bottom: bottomOffset,\n        left: tableCenterX,\n        containerWidth: containerRect.width,\n        isReady: true,\n      })\n    }\n  }, [tableContainerRef, bodyRef, bottomOffset, barHeight])\n\n  useEffect(() => {\n    let resizeObserver: ResizeObserver | null = null\n    let retryFrame: number | null = null\n\n    const setup = () => {\n      const container = tableContainerRef.current\n      const body = bodyRef.current\n\n      if (!container || !body) {\n        // Refs not ready, retry on next frame\n        retryFrame = requestAnimationFrame(setup)\n        return\n      }\n\n      // Initial calculation\n      calculatePosition()\n\n      // Set up ResizeObserver\n      resizeObserver = new ResizeObserver(() => {\n        requestAnimationFrame(calculatePosition)\n      })\n      resizeObserver.observe(body)\n      resizeObserver.observe(container)\n    }\n\n    // Start setup (will retry if refs not ready)\n    setup()\n\n    // Set up scroll/resize listeners immediately\n    const handleScroll = () => requestAnimationFrame(calculatePosition)\n    const handleResize = () => requestAnimationFrame(calculatePosition)\n\n    window.addEventListener('scroll', handleScroll, { passive: true })\n    window.addEventListener('resize', handleResize)\n\n    return () => {\n      if (retryFrame) cancelAnimationFrame(retryFrame)\n      resizeObserver?.disconnect()\n      window.removeEventListener('scroll', handleScroll)\n      window.removeEventListener('resize', handleResize)\n    }\n  }, [calculatePosition, tableContainerRef, bodyRef])\n\n  // Build style object based on positioning mode\n  if (position.mode === 'fixed') {\n    return {\n      mode: 'fixed',\n      isReady: position.isReady,\n      style: {\n        position: 'fixed',\n        bottom: `${position.bottom}px`,\n        left: `${position.left}px`,\n        transform: 'translateX(-50%)',\n        zIndex: 50,\n      },\n    }\n  }\n\n  // Absolute mode - centers naturally on table container\n  return {\n    mode: 'absolute',\n    isReady: position.isReady,\n    style: {\n      position: 'absolute',\n      top: `${position.top}px`,\n      left: '50%',\n      transform: 'translateX(-50%)',\n      zIndex: 50,\n    },\n  }\n}\n"]}