{"version":3,"file":"use-sticky-data-table.js","sourceRoot":"/","sources":["other-repos/demo-repo/src/components/ui/prod/data/sticky-data-table/hooks/core/use-sticky-data-table.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client'\n\n/**\n * StickyDataTable V2 - Main Table Hook\n *\n * Orchestrates all table state and logic in a single hook.\n * Extracted from index.tsx for better testability and separation of concerns.\n *\n * This hook manages:\n * - Column visibility and configuration\n * - Sorting (client-side or server-side)\n * - Scroll synchronization\n * - Row selection\n * - Infinite scroll handling\n * - Configuration merging\n *\n * @module hooks/use-sticky-data-table\n */\n\nimport { useMemo, useRef, type ReactNode } from 'react'\nimport * as React from 'react'\n\nimport {\n  createBackgroundConfig,\n  createBorderConfig,\n  createStickyState,\n  createToolbarLayoutConfig,\n  DEFAULT_BACKGROUND_CONFIG,\n  TABLE_CONFIG,\n  type ToolbarLayoutConfig,\n} from '../../config'\nimport { useTablePageBackground, getBackgroundCssVar } from '../../context/page-background-context'\nimport type {\n  BackgroundConfig,\n  BorderConfig,\n  ColumnConfig,\n  ColumnChange,\n  ComputedColumn,\n  InfiniteScrollConfig,\n  SelectionState,\n  SortColumn,\n  SortDirection,\n  StickyState,\n} from '../../types'\nimport { computeColumnOffsets, separateColumns } from '../../utils'\nimport { useColumns } from '../column/use-columns'\nimport { useScrollSync } from '../scroll/use-scroll-sync'\nimport { useSelection } from '../state/use-selection'\nimport { useSort } from '../state/use-sort'\nimport { useWheelRedirect } from '../scroll/use-wheel-redirect'\nimport { LoadMoreSkeleton } from '../../components'\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\n/**\n * Props for the useStickyDataTable hook\n * Mirrors the main component props for logic extraction\n */\nexport interface UseStickyDataTableProps<T extends Record<string, unknown>> {\n  data: T[]\n  columns: ColumnConfig[]\n  columnLabels: Record<string, string>\n  borderRadius?: number\n  borderConfig?: Partial<BorderConfig>\n  backgroundConfig?: Partial<BackgroundConfig>\n  showColumnControl?: boolean\n  enableSelection?: boolean\n  getRowId?: (row: T, index: number) => string | number\n  exportAll?: () => void | Promise<void>\n  exportSelected?: (selectionState: SelectionState) => void | Promise<void>\n  exportToolbar?: ReactNode\n  defaultHiddenColumns?: string[]\n  defaultVisibleColumns?: string[]\n  leftToolbar?: ReactNode\n  rightToolbar?: ReactNode\n  showCount?: boolean\n  // Toolbar layout\n  toolbarLayout?: ToolbarLayoutConfig\n  // Server-side sorting\n  serverSideSort?: boolean\n  onServerSort?: (columnKey: string, direction: SortDirection) => void\n  serverSortColumn?: string | null\n  serverSortDirection?: SortDirection\n  // Infinite scroll\n  infiniteScroll?: InfiniteScrollConfig\n  // Legacy props\n  loadingIndicator?: ReactNode\n  onEndReached?: () => void\n  onEndReachedThreshold?: number\n}\n\n/**\n * Return value from useStickyDataTable hook\n * Provides all state and handlers needed by the component\n */\nexport interface UseStickyDataTableReturn<T extends Record<string, unknown>> {\n  // Refs\n  headerScrollRef: React.RefObject<HTMLDivElement | null>\n  bodyScrollRef: React.RefObject<HTMLDivElement | null>\n\n  // Merged configs\n  borderConfig: BorderConfig\n  backgroundConfig: BackgroundConfig\n  /** CSS variable for gradient overlays - matches headerWrapper background */\n  gradientBackgroundCssVar: string\n\n  // Column state\n  columnsWithSelection: ColumnConfig[]\n  stickyColumns: ComputedColumn[]\n  scrollableColumns: ComputedColumn[]\n  allVisibleColumns: ComputedColumn[]\n  visibleColumnKeys: Set<string>\n  leavingColumnKeys: Set<string>\n  leavingColumns: ComputedColumn[]\n  enteringColumnKeys: Set<string>\n  columnChange: ColumnChange | null\n  toggleColumn: (key: string) => void\n  resetColumns: () => void\n  totalStickyWidth: number\n  columnLabelsWithCheckbox: Record<string, string>\n\n  // Sort state\n  sortColumn: SortColumn\n  sortDirection: SortDirection\n  sortedData: T[]\n  handleSort: (columnKey: string) => void\n\n  // Scroll state\n  stickyState: StickyState\n  showScrollIndicator: boolean\n  handleScrollLeft: () => void\n  handleScrollRight: () => void\n\n  // Selection state (null when selection is disabled)\n  selectionState: SelectionState | null\n\n  // Toolbar state\n  showExportButton: boolean\n  showToolbar: boolean\n\n  // Toolbar layout (resolved with defaults, leftCount/rightCount are runtime values)\n  toolbarLayout: ToolbarLayoutConfig\n\n  // Infinite scroll\n  effectiveOnEndReached: (() => void) | undefined\n  effectiveThreshold: number\n  effectiveLoadingIndicator: ReactNode\n}\n\n// ============================================================================\n// HOOK IMPLEMENTATION\n// ============================================================================\n\n/**\n * Main orchestration hook for StickyDataTable\n *\n * Extracts all business logic from the main component, making it:\n * - Testable in isolation\n * - Reusable for custom table implementations\n * - Easier to understand and maintain\n *\n * @example\n * ```tsx\n * const tableState = useStickyDataTable({\n *   data,\n *   columns,\n *   columnLabels,\n *   enableSelection: true,\n *   getRowId: (row) => row.id,\n * })\n *\n * // Use tableState in your custom rendering\n * ```\n */\nexport function useStickyDataTable<T extends Record<string, unknown>>({\n  data,\n  columns,\n  columnLabels,\n  borderRadius = TABLE_CONFIG.DEFAULT_BORDER_RADIUS,\n  borderConfig: borderConfigOverrides,\n  backgroundConfig: backgroundConfigOverrides,\n  showColumnControl = true,\n  enableSelection = false,\n  getRowId,\n  exportAll,\n  exportSelected,\n  exportToolbar,\n  defaultHiddenColumns = [],\n  defaultVisibleColumns,\n  leftToolbar,\n  rightToolbar,\n  showCount = false,\n  // Toolbar layout\n  toolbarLayout: toolbarLayoutOverrides,\n  // Server-side sorting\n  serverSideSort = false,\n  onServerSort,\n  serverSortColumn,\n  serverSortDirection,\n  // Infinite scroll\n  infiniteScroll,\n  // Legacy props\n  loadingIndicator,\n  onEndReached,\n  onEndReachedThreshold,\n}: UseStickyDataTableProps<T>): UseStickyDataTableReturn<T> {\n  // ==========================================================================\n  // DEPRECATION WARNINGS\n  // ==========================================================================\n\n  if (process.env.NODE_ENV === 'development') {\n    if (loadingIndicator !== undefined) {\n      console.warn(\n        '[StickyDataTable] loadingIndicator is deprecated. Use infiniteScroll.customIndicator instead.'\n      )\n    }\n    if (onEndReached !== undefined) {\n      console.warn(\n        '[StickyDataTable] onEndReached is deprecated. Use infiniteScroll.onLoadMore instead.'\n      )\n    }\n    if (onEndReachedThreshold !== undefined) {\n      console.warn(\n        '[StickyDataTable] onEndReachedThreshold is deprecated. Use infiniteScroll.threshold instead.'\n      )\n    }\n  }\n\n  // ==========================================================================\n  // REFS\n  // ==========================================================================\n\n  const headerScrollRef = useRef<HTMLDivElement>(null)\n  const bodyScrollRef = useRef<HTMLDivElement>(null)\n\n  // ==========================================================================\n  // PAGE BACKGROUND CONTEXT\n  // ==========================================================================\n\n  // Read page background from React context (if provider is present)\n  const pageBackground = useTablePageBackground()\n\n  // ==========================================================================\n  // MERGED CONFIGS\n  // ==========================================================================\n\n  const borderConfig = useMemo(\n    () => createBorderConfig(borderConfigOverrides),\n    [borderConfigOverrides]\n  )\n\n  // Background config merges in this priority order:\n  // 1. Explicit backgroundConfig.headerWrapper that differs from default (highest priority)\n  // 2. Page background from React context\n  // 3. Default configuration\n  //\n  // Note: We check if headerWrapper differs from the default because toTableProps()\n  // always includes the full config. Only treat it as an explicit override if\n  // the user intentionally changed it from the default.\n  const isExplicitHeaderWrapperOverride = useMemo(() => {\n    if (!backgroundConfigOverrides?.headerWrapper) return false\n    return backgroundConfigOverrides.headerWrapper !== DEFAULT_BACKGROUND_CONFIG.headerWrapper\n  }, [backgroundConfigOverrides?.headerWrapper])\n\n  const backgroundConfig = useMemo(() => {\n    // If explicit headerWrapper override (different from default), use it\n    if (isExplicitHeaderWrapperOverride) {\n      return createBackgroundConfig(backgroundConfigOverrides)\n    }\n\n    // If page background context is available, use it as the headerWrapper\n    if (pageBackground) {\n      return createBackgroundConfig({\n        ...backgroundConfigOverrides,\n        headerWrapper: pageBackground.backgroundClass,\n      })\n    }\n\n    // Fall back to defaults\n    return createBackgroundConfig(backgroundConfigOverrides)\n  }, [backgroundConfigOverrides, pageBackground, isExplicitHeaderWrapperOverride])\n\n  // Compute CSS variable for gradient overlays\n  // Priority: explicit override > context > default\n  const gradientBackgroundCssVar = useMemo(() => {\n    if (isExplicitHeaderWrapperOverride && backgroundConfigOverrides?.headerWrapper) {\n      return getBackgroundCssVar(backgroundConfigOverrides.headerWrapper)\n    }\n    if (pageBackground) {\n      return pageBackground.backgroundCssVar\n    }\n    return 'var(--background-color-secondary_alt)'\n  }, [isExplicitHeaderWrapperOverride, backgroundConfigOverrides?.headerWrapper, pageBackground])\n\n  // Toolbar layout config (resolved with defaults)\n  const toolbarLayout = useMemo(\n    () => createToolbarLayoutConfig(toolbarLayoutOverrides),\n    [toolbarLayoutOverrides]\n  )\n\n  // ==========================================================================\n  // SELECTION SETUP\n  // ==========================================================================\n\n  // Generate row IDs for selection\n  const rowIds = useMemo(() => {\n    if (!enableSelection || !getRowId) return []\n    return data.map((row, index) => getRowId(row, index))\n  }, [data, enableSelection, getRowId])\n\n  // Selection state\n  const selectionState = useSelection({\n    rowIds,\n    enabled: enableSelection,\n  })\n\n  // ==========================================================================\n  // COLUMNS WITH SELECTION\n  // ==========================================================================\n\n  // Add checkbox column if selection enabled\n  const columnsWithSelection = useMemo(() => {\n    if (!enableSelection) return columns\n\n    // Check if checkbox column already exists\n    if (columns.some((col) => col.key === '__checkbox')) return columns\n\n    // Add checkbox column as first sticky column\n    const checkboxColumn: ColumnConfig = {\n      key: '__checkbox',\n      width: 48,\n      align: 'center',\n      isSticky: true,\n      stickyLeft: 0,\n      sortable: false,\n    }\n\n    // Adjust stickyLeft for existing sticky columns\n    const adjustedColumns = columns.map((col) => {\n      if (col.isSticky && col.stickyLeft !== undefined) {\n        return { ...col, stickyLeft: col.stickyLeft + checkboxColumn.width }\n      }\n      return col\n    })\n\n    return [checkboxColumn, ...adjustedColumns]\n  }, [columns, enableSelection])\n\n  // ==========================================================================\n  // COLUMN MANAGEMENT\n  // ==========================================================================\n\n  const {\n    stickyColumns: rawStickyColumns,\n    scrollableColumns: rawScrollableColumns,\n    visibleColumnKeys,\n    leavingColumnKeys,\n    leavingColumns,\n    enteringColumnKeys,\n    columnChange,\n    toggleColumn,\n    resetColumns,\n    totalStickyWidth,\n  } = useColumns({\n    columns: columnsWithSelection,\n    defaultHiddenColumns,\n    defaultVisibleColumns,\n  })\n\n  // Compute column positions (leaving columns excluded - rendered as absolute overlay)\n  // IMPORTANT: Sticky columns MUST come first to match grid template order (sticky first, then scrollable)\n  const allVisibleColumns = useMemo(() => {\n    const visible = columnsWithSelection.filter((col) => visibleColumnKeys.has(col.key))\n    // Reorder so sticky columns always come first (maintains relative order within each group)\n    const sticky = visible.filter((col) => col.isSticky)\n    const scrollable = visible.filter((col) => !col.isSticky)\n    return computeColumnOffsets([...sticky, ...scrollable])\n  }, [columnsWithSelection, visibleColumnKeys])\n\n  const { stickyColumns, scrollableColumns } = useMemo(\n    () => separateColumns(allVisibleColumns),\n    [allVisibleColumns]\n  )\n\n  // ==========================================================================\n  // SORTING\n  // ==========================================================================\n\n  // Client-side sorting\n  const clientSort = useSort({ data })\n\n  // Determine which sort state to use\n  const sortColumn = serverSideSort ? (serverSortColumn ?? null) : clientSort.sortColumn\n  const sortDirection = serverSideSort ? (serverSortDirection ?? 'desc') : clientSort.sortDirection\n  const sortedData = serverSideSort ? data : clientSort.sortedData\n\n  // Handle sort click - delegates to server or client\n  const handleSort = (columnKey: string) => {\n    if (serverSideSort && onServerSort) {\n      // Server-side: calculate new direction and call callback\n      const newDirection = sortColumn === columnKey ? (sortDirection === 'asc' ? 'desc' : 'asc') : 'desc'\n      onServerSort(columnKey, newDirection)\n    } else {\n      // Client-side: use internal hook\n      clientSort.handleSort(columnKey)\n    }\n  }\n\n  // ==========================================================================\n  // SCROLL SYNCHRONIZATION\n  // ==========================================================================\n\n  const { canScrollLeft, canScrollRight, showScrollIndicator, handleScrollLeft, handleScrollRight } = useScrollSync({\n    headerRef: headerScrollRef,\n    bodyRef: bodyScrollRef,\n  })\n\n  // Wheel redirect for vertical scrolling\n  useWheelRedirect({ bodyRef: bodyScrollRef })\n\n  // Create sticky state\n  const stickyState = useMemo(\n    () => createStickyState(canScrollLeft, canScrollRight),\n    [canScrollLeft, canScrollRight]\n  )\n\n  // ==========================================================================\n  // COLUMN LABELS\n  // ==========================================================================\n\n  const columnLabelsWithCheckbox = useMemo(() => {\n    if (!enableSelection) return columnLabels\n    return { __checkbox: '', ...columnLabels }\n  }, [columnLabels, enableSelection])\n\n  // ==========================================================================\n  // TOOLBAR STATE\n  // ==========================================================================\n\n  const showExportButton = !!(exportAll || exportSelected || exportToolbar)\n  const showToolbar = !!(leftToolbar || rightToolbar || showExportButton || showColumnControl || showCount)\n\n  // ==========================================================================\n  // INFINITE SCROLL\n  // ==========================================================================\n\n  // Compute effective infinite scroll values (new API takes precedence over legacy)\n  const effectiveOnEndReached = useMemo(() => {\n    if (infiniteScroll) {\n      // New API: only trigger if hasNextPage and not already loading\n      return infiniteScroll.hasNextPage && !infiniteScroll.isLoadingMore\n        ? infiniteScroll.onLoadMore\n        : undefined\n    }\n    // Legacy API fallback\n    return onEndReached\n  }, [infiniteScroll, onEndReached])\n\n  const effectiveThreshold = infiniteScroll?.threshold ?? onEndReachedThreshold ?? 200\n\n  // Generate loading indicator for infinite scroll load more\n  // Priority:\n  // 1. loadingIndicator prop (shown only during load more when infiniteScroll is active)\n  // 2. infiniteScroll.customIndicator (shown only during load more)\n  // 3. Auto-generated LoadMoreSkeleton (shown only during load more)\n  //\n  // NOTE: Loading indicator is only shown when actively loading more pages.\n  // Initial load skeletons are handled separately via isLoading + skeletonConfig.\n  const effectiveLoadingIndicator = useMemo(() => {\n    // Only show loading indicator during infinite scroll load more\n    const isLoadingMore = infiniteScroll?.isLoadingMore ?? false\n\n    if (!isLoadingMore) {\n      return null\n    }\n\n    // If explicit loadingIndicator prop is passed, use it during load more\n    if (loadingIndicator) {\n      return loadingIndicator\n    }\n\n    // If using new infiniteScroll config\n    if (infiniteScroll) {\n      // Custom indicator takes precedence\n      if (infiniteScroll.customIndicator) {\n        return infiniteScroll.customIndicator\n      }\n\n      // Auto-generate LoadMoreSkeleton when loading more pages\n      return (\n        <LoadMoreSkeleton\n          columns={columnsWithSelection}\n          rowCount={infiniteScroll.skeletonRowCount ?? 5}\n          asRowsOnly={true}\n          rowHeight={TABLE_CONFIG.ROW_HEIGHT}\n          enableSelection={enableSelection}\n          defaultVisibleColumns={defaultVisibleColumns}\n          borderConfig={borderConfigOverrides}\n          backgroundConfig={backgroundConfigOverrides}\n          // stickyState will be injected by TableBody via React.cloneElement\n        />\n      )\n    }\n\n    return null\n  }, [\n    infiniteScroll,\n    loadingIndicator,\n    columnsWithSelection,\n    enableSelection,\n    defaultVisibleColumns,\n    borderConfigOverrides,\n    backgroundConfigOverrides,\n  ])\n\n  // ==========================================================================\n  // RETURN\n  // ==========================================================================\n\n  return {\n    // Refs\n    headerScrollRef,\n    bodyScrollRef,\n\n    // Merged configs\n    borderConfig,\n    backgroundConfig,\n    gradientBackgroundCssVar,\n\n    // Column state\n    columnsWithSelection,\n    stickyColumns,\n    scrollableColumns,\n    allVisibleColumns,\n    visibleColumnKeys,\n    leavingColumnKeys,\n    leavingColumns,\n    enteringColumnKeys,\n    columnChange,\n    toggleColumn,\n    resetColumns,\n    totalStickyWidth,\n    columnLabelsWithCheckbox,\n\n    // Sort state\n    sortColumn,\n    sortDirection,\n    sortedData,\n    handleSort,\n\n    // Scroll state\n    stickyState,\n    showScrollIndicator,\n    handleScrollLeft,\n    handleScrollRight,\n\n    // Selection state\n    selectionState,\n\n    // Toolbar state\n    showExportButton,\n    showToolbar,\n\n    // Toolbar layout (resolved with defaults)\n    toolbarLayout,\n\n    // Infinite scroll\n    effectiveOnEndReached,\n    effectiveThreshold,\n    effectiveLoadingIndicator,\n  }\n}\n"]}