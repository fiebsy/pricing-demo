{"version":3,"file":"page.js","sourceRoot":"/","sources":["other-repos/demo-repo/src/app/studio/page.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Delphi AI Studio - Audience Tab Dashboard\n *\n * Live dashboard showing everyone who has interacted with your Delphi.\n * Monitor engagement, apply filters, manage tags and access.\n *\n * Route: /studio\n */\n\n'use client'\n\nimport React, { useState, useMemo, useCallback, useDeferredValue } from 'react'\n\nimport {\n  StickyDataTable,\n  TableEmptyState,\n  useColumnConfiguration,\n  type SelectionState,\n} from '@/components/ui/prod/data/sticky-data-table'\n\n// Studio module imports\nimport {\n  HARDENED_DIMENSIONS,\n  HARDENED_BORDER_CONFIG,\n  HARDENED_BACKGROUND_CONFIG,\n  HARDENED_TOOLBAR_CONFIG,\n  HARDENED_FEATURES,\n} from '@/modules/studio/config/hardened-preset'\nimport {\n  PAGE_SIZE,\n  AUDIENCE_COLUMNS,\n  COLUMN_LABELS,\n  COLUMN_TO_SORT_FIELD,\n} from '@/modules/studio/config/column-config'\nimport { FILTER_DISPLAY_LABELS, applyFilters } from '@/modules/studio/config/filter-config'\nimport { useMockAudience } from '@/modules/studio/hooks/use-mock-audience'\nimport { MetricTileBar } from '@/modules/studio/components/metric-tile-bar'\nimport { LeftToolbarContent, RightToolbarContent } from '@/modules/studio/components/toolbar'\nimport { renderCell } from '@/modules/studio/components/cell-renderer'\n\nimport type {\n  AudienceMetricId,\n  ActiveFilter,\n  AudienceFilterId,\n  AudienceSortField,\n  AudienceSortOrder,\n} from '@/modules/studio/types'\n\n// ============================================================================\n// MAIN PAGE COMPONENT\n// ============================================================================\n\nexport default function StudioPage() {\n  // Search state\n  const [searchQuery, setSearchQuery] = useState('')\n  const [searchExpanded, setSearchExpanded] = useState(false)\n\n  // Filter state - default to no filters\n  const [activeFilters, setActiveFilters] = useState<ActiveFilter[]>([])\n\n  // Active metric for highlighting tiles (no filter by default)\n  const [activeMetric, setActiveMetric] = useState<AudienceMetricId | null>(null)\n\n  // Server-side sort state\n  const [sortBy, setSortBy] = useState<AudienceSortField>('LAST_INTERACTED')\n  const [sortOrder, setSortOrder] = useState<AudienceSortOrder>('DESC')\n  const [sortColumnKey, setSortColumnKey] = useState<string | null>('lastInteracted')\n\n  // Column configuration (no drag-to-reorder for this dashboard)\n  const {\n    columns: orderedColumns,\n    reorderColumns,\n    isHydrated: isColumnConfigHydrated,\n  } = useColumnConfiguration({\n    columns: AUDIENCE_COLUMNS,\n    storageKey: 'studio-audience-columns',\n  })\n\n  // Fetch data using mock pagination hook\n  const {\n    items,\n    isLoading,\n    isLoadingMore,\n    totalCount,\n    hasNextPage,\n    loadMore,\n    metrics,\n  } = useMockAudience({\n    pageSize: PAGE_SIZE,\n    sortBy,\n    sortOrder,\n    searchQuery: searchQuery || undefined,\n    delay: 300,\n  })\n\n  // Deferred filters for table - allows chips to animate immediately while table catches up\n  const deferredActiveFilters = useDeferredValue(activeFilters)\n\n  // Apply client-side filters using DEFERRED value\n  const filteredItems = useMemo(() => {\n    return applyFilters(items, deferredActiveFilters)\n  }, [items, deferredActiveFilters])\n\n  // Metric click handler - apply filters based on metric\n  const handleMetricClick = useCallback((metricId: AudienceMetricId) => {\n    // Toggle metric selection\n    if (activeMetric === metricId) {\n      setActiveMetric(null)\n      // Don't clear filters - just deselect the metric tile\n      return\n    }\n\n    setActiveMetric(metricId)\n\n    // Apply specific filters based on metric\n    switch (metricId) {\n      case 'totalActive':\n        // Filter to show only active users\n        setActiveFilters([\n          {\n            id: 'status-active',\n            label: FILTER_DISPLAY_LABELS['status-active'].label,\n            value: FILTER_DISPLAY_LABELS['status-active'].value,\n            category: FILTER_DISPLAY_LABELS['status-active'].category,\n          },\n        ])\n        break\n      case 'totalMessages':\n        // No specific filter - show all (clear any message filters)\n        setActiveFilters((prev) =>\n          prev.filter((f) => !f.id.startsWith('messages-'))\n        )\n        break\n      case 'avgMessages':\n        // No specific filter\n        break\n      case 'mostEngaged':\n        // Filter to show users with 51+ messages\n        setActiveFilters([\n          {\n            id: 'messages-51+',\n            label: FILTER_DISPLAY_LABELS['messages-51+'].label,\n            value: FILTER_DISPLAY_LABELS['messages-51+'].value,\n            category: FILTER_DISPLAY_LABELS['messages-51+'].category,\n          },\n        ])\n        break\n    }\n  }, [activeMetric])\n\n  // Filter handlers\n  const handleFilterSelect = useCallback((filterId: string) => {\n    const id = filterId as AudienceFilterId\n    const displayInfo = FILTER_DISPLAY_LABELS[id]\n    if (!displayInfo) return\n\n    setActiveFilters((prev) => {\n      // Check if already active\n      if (prev.some((f) => f.id === id)) {\n        // Remove it\n        return prev.filter((f) => f.id !== id)\n      } else {\n        // Add it\n        return [\n          ...prev,\n          {\n            id,\n            label: displayInfo.label,\n            value: displayInfo.value,\n            category: displayInfo.category,\n          },\n        ]\n      }\n    })\n    // Clear metric selection when manually filtering\n    setActiveMetric(null)\n  }, [])\n\n  const handleFilterRemove = useCallback((filterId: string) => {\n    setActiveFilters((prev) => prev.filter((f) => f.id !== filterId))\n    setActiveMetric(null)\n  }, [])\n\n  const handleFilterChange = useCallback((oldFilterId: string, newFilterId: string) => {\n    const id = newFilterId as AudienceFilterId\n    const displayInfo = FILTER_DISPLAY_LABELS[id]\n    if (!displayInfo) return\n\n    setActiveFilters((prev) =>\n      prev.map((f) =>\n        f.id === oldFilterId\n          ? {\n              id,\n              label: displayInfo.label,\n              value: displayInfo.value,\n              category: displayInfo.category,\n            }\n          : f\n      )\n    )\n    setActiveMetric(null)\n  }, [])\n\n  const handleFiltersClear = useCallback(() => {\n    setActiveFilters([])\n    setActiveMetric(null)\n  }, [])\n\n  // Clear ALL filters, search, and metric filter\n  const handleClearAll = useCallback(() => {\n    setActiveFilters([])\n    setSearchQuery('')\n    setActiveMetric(null)\n  }, [])\n\n  // Determine if any filters/search are active\n  const hasAnyFilters = activeFilters.length > 0 || !!searchQuery\n\n  // Handle server-side sort\n  const handleServerSort = useCallback((columnKey: string, direction: 'asc' | 'desc') => {\n    const backendSortField = COLUMN_TO_SORT_FIELD[columnKey]\n\n    if (!backendSortField) {\n      // Column not sortable on server\n      return\n    }\n\n    setSortColumnKey(columnKey)\n    setSortBy(backendSortField)\n    setSortOrder(direction === 'asc' ? 'ASC' : 'DESC')\n  }, [])\n\n  // Row click handler (would open profile drawer in real app)\n  const handleRowClick = useCallback((row: typeof items[0]) => {\n    console.log('Row clicked:', row.name, row.email)\n    // In real app: open profile sheet/drawer\n  }, [])\n\n  // Export handlers\n  const handleExportAll = useCallback(async () => {\n    console.log('Export all:', filteredItems.length, 'users')\n  }, [filteredItems.length])\n\n  const handleExportSelected = useCallback(async (selectionState: SelectionState) => {\n    console.log('Export selected:', selectionState?.selectedIds.size ?? 0, 'users')\n  }, [])\n\n  return (\n    <div className=\"mx-auto w-full max-w-[1200px] px-6 pt-16\">\n      {/* Page Header */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-primary text-xl font-semibold lg:text-2xl\">Audience</h1>\n        <p className=\"text-tertiary mt-1 text-sm\">\n          Everyone who has interacted with your Delphi\n        </p>\n      </div>\n\n      {/* Metric Tiles - Engagement Overview */}\n      <MetricTileBar\n        activeMetric={activeMetric}\n        onMetricClick={handleMetricClick}\n        metrics={metrics}\n        className=\"mb-8\"\n      />\n\n      {/* Audience Table - Hardened Configuration */}\n      <StickyDataTable\n        data={isLoading ? [] : filteredItems}\n        columns={orderedColumns}\n        columnLabels={COLUMN_LABELS}\n        renderCell={renderCell}\n        onRowClick={handleRowClick}\n        // Hardened dimensions\n        borderRadius={HARDENED_DIMENSIONS.borderRadius}\n        headerHeight={HARDENED_DIMENSIONS.headerHeight}\n        rowHeight={HARDENED_DIMENSIONS.rowHeight}\n        // Hardened styling\n        borderConfig={HARDENED_BORDER_CONFIG}\n        backgroundConfig={HARDENED_BACKGROUND_CONFIG}\n        toolbarLayout={HARDENED_TOOLBAR_CONFIG}\n        className=\"relative\"\n        // Features - hardened\n        enableSelection={HARDENED_FEATURES.enableSelection}\n        showColumnControl={HARDENED_FEATURES.showColumnControl}\n        enableColumnReorder={HARDENED_FEATURES.enableColumnReorder}\n        onReorderColumns={reorderColumns}\n        isColumnConfigHydrated={isColumnConfigHydrated}\n        getRowId={(row) => String(row.id)}\n        // Left toolbar - Filter menu\n        leftToolbar={\n          <LeftToolbarContent\n            activeFilters={activeFilters}\n            onFilterSelect={handleFilterSelect}\n            onFilterChange={handleFilterChange}\n            onFilterRemove={handleFilterRemove}\n            onFiltersClear={handleFiltersClear}\n          />\n        }\n        // Right toolbar - Expanding search\n        rightToolbar={\n          <RightToolbarContent\n            value={searchQuery}\n            onChange={setSearchQuery}\n            expanded={searchExpanded}\n            onExpandedChange={setSearchExpanded}\n          />\n        }\n        // Count display\n        showCount={HARDENED_FEATURES.showCount}\n        totalCount={filteredItems.length}\n        countLabel=\"users\"\n        // Server-side sorting\n        serverSideSort={true}\n        onServerSort={handleServerSort}\n        serverSortColumn={sortColumnKey}\n        serverSortDirection={sortOrder === 'ASC' ? 'asc' : 'desc'}\n        // Export\n        exportAll={handleExportAll}\n        exportSelected={handleExportSelected}\n        // Infinite scroll\n        infiniteScroll={{\n          hasNextPage,\n          isLoadingMore,\n          onLoadMore: loadMore,\n          threshold: 200,\n        }}\n        // Loading state\n        isLoading={isLoading}\n        // Empty states\n        searchTerm={searchQuery || undefined}\n        hasActiveFilters={hasAnyFilters}\n        emptyState={\n          <TableEmptyState\n            variant=\"empty\"\n            title=\"No users yet\"\n            description=\"Users will appear here once they interact with your Delphi.\"\n          />\n        }\n        noResultsState={\n          <TableEmptyState\n            variant=\"no-results\"\n            searchTerm={searchQuery || undefined}\n            description={\n              searchQuery\n                ? undefined // Uses default \"No results found for X\" when searchTerm is set\n                : activeFilters.length > 0\n                  ? `No users match your current filters. Try adjusting or clearing them.`\n                  : undefined\n            }\n            secondaryAction={\n              hasAnyFilters\n                ? { label: 'Clear filters', onClick: handleClearAll }\n                : undefined\n            }\n          />\n        }\n      />\n    </div>\n  )\n}\n"]}